---
layout: default1
nav: adbkt-pruefungen
title: P6
is_slide: 0
---

<h1>JSON aus GraphQL-Abfragen erzeugen</h1>

<p class="w3-large">
  In dieser Aufgabe sollen sie aus vereinfachten GraphQL-Abfragen Postgres-SQL-Code erzeugen, der JSON-Strukturen als Antwort zurückliefert.
</p>
<p class="w3-large">
    Grundlage für die Erzeugung sind Tabellen, die durch Fremdschlüssel miteinander verbunden sind, wie im folgenden Beispiel. GraphQL ermöglicht einen einfachen Zugriff auf solche Strukturen und liefert JSON zurück, das dann in Anwendungsprogrammen direkt weiterverwendet werden kann.
</p>

<div class="w3-center"><img  class="w3-image" src="/home/lv/adbkt/a/graph-ql/100-100.png"></div>

<p class="w3-large">
    Konkret besteht ihr Aufgabe darin, in Python folgende Funktion zu implementieren:
    <pre><code class="python">def gql_to_jon(gql: AST) -> str</code></pre>
    Die Abfragen werden als Abstract Syntax Trees (AST) bereitgestellt:
    <pre><code class="python">@dataclass
class Cond():
    l: str
    r: str

@dataclass
class AST():
    name: str
    attr: list[str]
    cond: Optional[Cond] = None
    sub: Optional['AST'] = None</code></pre>
</p>

<p class="w3-large">
    Im Folgenden finden sie eine Reihe von Beispielabfragen, die für ihren Code als Test dienen sollen.
</p>


<table class="w3-table-all">
  <tr>
      <th>Abfrage</th>
      <th>Bedeutung</th>
  </tr>
  <tr>
      <td>Beispiel 01
      <pre><code class="graphql">t1 {
    a
}</code></pre></td>
      <td>Alle Objekte aus Tabelle "t1", e</td>
  </tr>

<tr>
    <td>Beispiel 02
    <pre><code class="graphql">t1 (a: 'a1') {
    a
    b
}</code></pre></td>
    <td>xxxxxxxxxxxxxxxxxx</td>
</tr>

<tr>
  <td>Beispiel 03
  <pre><code class="graphql">t1 (a: 'a1') {
    a
    b
    t2 {
        c
        d
    }
}</code></pre></td>
  <td>xxxxxxxxxxxxxxxxxx</td>
</tr>

<tr>
  <td>Beispiel 04
  <pre><code class="graphql">t1 (a: 'a1') {
    a
    b
    t2 (d: 'd12') {
        c
        d
    }
}</code></pre></td>
  <td>xxxxxxxxxxxxxxxxxx</td>
</tr>

<tr>
  <td>Beispiel 05
  <pre><code class="graphql">t1 (a: 'a1') {
    a
    b
    t2 (d: 'd12') {
        c
        d
        t3 {
            e
            f
        }
    }
}</code></pre></td>
  <td>xxxxxxxxxxxxxxxxxx</td>
</tr>

<tr>
  <td>Beispiel 06
  <pre><code class="graphql">t1 (a: 'a1') {
    a
    b
    t2 (d: 'd12') {
        c
        d
        t3 (f: 'f103') {
            e
            f
        }
    }
}</code></pre></td>
  <td>xxxxxxxxxxxxxxxxxx</td>
</tr>
</table>


<h2>Tabellen</h2>
<p class="w3-large">Zum Testen werde folgenden Beispieldaten bereitgestellt.</p>

<table class="w3-table-all">
  <tr>
      <th>t1</th>
      <th>t2</th>
      <th>t3</th>
  </tr>
  <tr>
      <td><img class="w3-image" src="/home/lv/adbkt/a/graph-ql/110-100.png"></td>
      <td><img class="w3-image" src="/home/lv/adbkt/a/graph-ql/120-100.png"></td>
      <td><img class="w3-image" src="/home/lv/adbkt/a/graph-ql/130-100.png"></td>
  </tr>
</table>

<h2>Auswertungsbeispiele</h2>
<p class="w3-large">Die  Auswertungsbeispiele basieren auf folgenden Beispieldaten</p>


<table class="w3-table-all">
  <tr>
      <th>Abfrage</th>
      <th>Erwartetes JSON-Ergebnis</th>
  </tr>
  <tr>
      <td>Beispiel 01
      <pre><code class="graphql">t1 {
    a
}</code></pre></td>
      <td>    <pre><code class="json">[
      {
          "a": "a1"
      },
      {
          "a": "a2"
      }
]</code></pre></td>
  </tr>

<tr>
    <td>Beispiel 02
    <pre><code class="graphql">t1 (a: 'a1') {
    a
    b
}</code></pre></td>
    <td>    <pre><code class="json">[
    {
        "a": "a1",
        "b": "b1"
    }
]</code></pre></td>
</tr>

<tr>
  <td>Beispiel 03
  <pre><code class="graphql">t1 (a: 'a1') {
    a
    b
    t2 {
        c
        d
    }
}</code></pre></td>
  <td>    <pre><code class="json">[
    {
        "a": "a1",
        "b": "b1",
        "t2": [
            {
                "c": "c11",
                "d": "d11"
            },
            {
                "c": "c12",
                "d": "d12"
            }
        ]
    }
]</code></pre></td>
</tr>

<tr>
  <td>Beispiel 04
  <pre><code class="graphql">t1 (a: 'a1') {
    a
    b
    t2 (d: 'd12') {
        c
        d
    }
}</code></pre></td>
  <td>    <pre><code class="json">[
    {
        "a": "a1",
        "b": "b1",
        "t2": [
            {
                "c": "c12",
                "d": "d12"
            }
        ]
    }
]</code></pre></td>
</tr>

<tr>
  <td>Beispiel 05
  <pre><code class="graphql">t1 (a: 'a1') {
    a
    b
    t2 (d: 'd12') {
        c
        d
        t3 {
            e
            f
        }
    }
}</code></pre></td>
  <td>    <pre><code class="json">[
    {
        "a": "a1",
        "b": "b1",
        "t2": [
            {
                "c": "c12",
                "d": "d12",
                "t3": [
                    {
                        "e": "e103",
                        "f": "f103"
                    },
                    {
                        "e": "e104",
                        "f": "f104"
                    }
                ]
            }
        ]
    }
]</code></pre></td>
</tr>

<tr>
  <td>Beispiel 06
  <pre><code class="graphql">t1 (a: 'a1') {
    a
    b
    t2 (d: 'd12') {
        c
        d
        t3 (f: 'f103') {
            e
            f
        }
    }
}</code></pre></td>
  <td>    <pre><code class="json">[
    {
        "a": "a1",
        "b": "b1",
        "t2": [
            {
                "c": "c12",
                "d": "d12",
                "t3": [
                    {
                        "e": "e103",
                        "f": "f103"
                    }
                ]
            }
        ]
    }
]</code></pre></td>
</tr>
</table>



<!---->